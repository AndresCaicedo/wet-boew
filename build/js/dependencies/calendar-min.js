/*!
 * Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW)
 * www.tbs.gc.ca/ws-nw/wet-boew/terms / www.sct.gc.ca/ws-nw/wet-boew/conditions
 */
var calendar={create:function(g,k,i,h,a,m){var e,c=$("#"+g),f,b,l,d,n,j;c.addClass("cal-container");c.removeClass("cal-container-extended");f=calendar.getDateFromISOString(a);if(f===null){f=new Date();f.setFullYear(k-1,i,1)}b=calendar.getDateFromISOString(m);if(b===null){b=new Date();b.setFullYear(k+1,i,1)}if(k>b.getFullYear()||(k===b.getFullYear()&&i>b.getMonth())){k=b.getFullYear();i=b.getMonth()}else{if(k<f.getFullYear()||(k===f.getFullYear()&&i<f.getMonth())){k=f.getFullYear();i=f.getMonth()}}if(c.children("div#cal-"+g+"-cnt").length>0){c.children("div#cal-"+g+"-cnt").find("ol#cal-"+g+"-weekdays, .cal-month, div#cal-"+g+"-days").remove();e=c.children("div#cal-"+g+"-cnt")}else{e=$('<div id="cal-'+g+'-cnt" class="cal-cnt"></div>');c.append(e)}if(c.children("div#cal-"+g+"-cnt").children(".cal-header").length>0){l=c.children("div#cal-"+g+"-cnt").children(".cal-header")}else{l=$('<div class="cal-header"></div>')}l.prepend('<div class="cal-month">'+pe.dic.get("%calendar-monthNames")[i]+" "+k+"</div>");if(h){d=this.createMonthNav(g,k,i,f,b);if($("#cal-"+g+"-monthnav").length<1){l.append(d)}if(c.children("div#cal-"+g+"-cnt").children(".cal-header").children(".cal-goto").length<1){l.append(this.createGoToForm(g,k,i,f,b))}}e.append(l);e.append(this.createWeekdays(g));n=this.createDays(g,k,i);j=n.children("ol.cal-day-list").children("li");e.append(n);c.trigger("calendarDisplayed",[k,i,j])},createMonthNav:function(m,k,j,f,a){var c,p,h,o,e,i,l,b,d,g;if($("#cal-"+m+"-monthnav").length>0){c=$("#cal-"+m+"-monthnav")}else{c=$('<div id="cal-'+m+'-monthnav"></div>')}for(d=0;d<2;d+=1){i=true;l=null;b=null;switch(d){case 0:p="prevmonth";h=pe.dic.get("%calendar-previousMonth");if(j>0){o=j-1;e=k}else{o=11;e=k-1}if((o<f.getMonth()&&e<=f.getFullYear())||e<f.getFullYear()){i=false}break;case 1:p="nextmonth";h=pe.dic.get("%calendar-nextMonth");if(j<11){o=j+1;e=k}else{o=0;e=k+1}if((o>a.getMonth()&&e>=a.getFullYear())||e>a.getFullYear()){i=false}break}if(c.children(".cal-"+p).length>0){l=c.children(".cal-"+p)}if(i){g=h+pe.dic.get("%calendar-monthNames")[o]+" "+e;if(l){b=l.children("a");b.children("img").attr("alt",g).unbind()}else{l=$('<div class="cal-'+p+'"></div>');b=$('<a href="javascript:;" role="button"><img src="'+pe.add.liblocation+"images/calendar/"+p.substr(0,1)+'.gif" alt="'+g+'" /></a>');l.append(b);c.append(l)}b.bind("click",{year:e,month:o,mindate:calendar.getISOStringFromDate(f),maxdate:calendar.getISOStringFromDate(a)},function(n){calendar.create(m,n.data.year,n.data.month,true,n.data.mindate,n.data.maxdate);pe.focus($(this))})}else{if(l){l.remove()}}}return c},yearChanged:function(b){var j=$(this).val(),d=b.data.minDate,a=b.data.maxDate,f=b.data.monthField,g=0,c=11,h,e;if(j===d.getFullYear()){g=d.getMonth()}if(j===a.getFullYear()){c=a.getMonth()}h=f.val();while(f.children("option").length){f.get(0).remove(0)}for(e=g;e<=c;e+=1){f.append('<option value="'+e+'"'+((e===h)?' selected="selected"':"")+">"+pe.dic.get("%calendar-monthNames")[e]+"</option>")}},createGoToForm:function(o,h,q,e,g){var d=$('<div class="cal-goto"></div>'),c=$('<form id="cal-'+o+'-goto" role="form" style="display:none;" action=""><fieldset><legend>'+pe.dic.get("%calendar-goToTitle")+"</legend></fieldset></form>"),j,n,l,f,k,s,m,a,p,r,b,i;c.submit(function(){calendar.onGoTo(o,e,g);return false});j=c.children("fieldset");n=$('<div class="cal-goto-year"><label for="cal-'+o+'-goto-year" class="wb-invisible">'+pe.dic.get("%calendar-goToYear")+"</label></div>");l=$('<select id="cal-'+o+'-goto-year"></select>');for(f=e.getFullYear();f<=g.getFullYear();f+=1){l.append($('<option value="'+f+'"'+(f===h?' selected="selected"':"")+">"+f+"</option>"))}n.append(l);j.append(n);k=$('<div class="cal-goto-month"><label for="cal-'+o+'-goto-month" class="wb-invisible">'+pe.dic.get("%calendar-goToMonth")+"</label></div>");s=$('<select id="cal-'+o+'-goto-month"></select>');k.append(s);j.append(k);if(pe.ie===6){$(pe.dic.get("%calendar-monthNames")).each(function(t,u){s.append('<option value="'+t+'"'+((t===q)?' selected="selected"':"")+">"+u+"</option>")})}else{l.bind("change",{minDate:e,maxDate:g,monthField:s},this.yearChanged);l.change()}m=$('<div class="cal-goto-button"></div>');a=$('<input type="submit" value="'+pe.dic.get("%calendar-goToButton")+'" />');m.append(a);j.append(m);p=$('<div class="cal-goto-button"></div>');r=$('<input type="button" value="'+pe.dic.get("%calendar-cancelButton")+'" />');r.click(function(){calendar.hideGoToForm(o)});p.append(r);j.append(p);b=$('<p class="cal-goto-link" id="cal-'+o+'-goto-link"></p>');i=$('<a href="javascript:;" role="button" aria-controls="cal-'+o+'-goto" aria-expanded="false">'+pe.dic.get("%calendar-goToLink")+"</a>");i.on("click",function(){calendar.showGoToForm(o)});b.append(i);d.append(b);d.append(c);return d},createWeekdays:function(c){var b=$('<ol id="cal-'+c+'-weekdays" class="cal-weekdays" role="presentation"></ol>'),d,a,e;for(d=0;d<7;d+=1){a=pe.dic.get("%calendar-weekDayNames")[d];e=$('<li id="cal-'+c+"-wd"+(d+1)+'" class="cal-wd'+(d+1)+'"><abbr title="'+a+'">'+a.substr(0,1)+"</abbr></li>");if(d===0||d===6){e.addClass="we"}b.append(e)}return b},createDays:function(n,k,i){var q=$('<div id="cal-'+n+'-days" class="cal-days"></div>'),p=$('<ol id="cal-'+n+"-"+i+"_"+k+'" class="cal-day-list"></ol>'),e=new Date(),a,l,d,f,b,m,g,h,c,j,o;e.setFullYear(k,i,1);a=e.getDay();e.setFullYear(k,i+1,0);l=e.getDate()-1;e=new Date();e.getDate();d=0;f=false;for(b=1;b<7;b+=1){for(m=0;m<7;m+=1){if((b===1&&m<a)||(d>l)){g=$('<span class="cal-empty">'+String.fromCharCode(160)+"</span>");h=q}else{d+=1;j=(d===e.getDate()&&i===e.getMonth()&&k===e.getFullYear());if(d===1){q.append(p)}if(d>l){f=true}g=$("<li></li>");c=$("<div></div>");if(pe.language==="en"){o="";if(d>10&&d<20){o="th"}else{switch(d%10){case 1:o="st";break;case 2:o="nd";break;case 3:o="rd";break;default:o="th"}}c.append('<span class="wb-invisible">'+pe.dic.get("%calendar-weekDayNames")[m]+" "+pe.dic.get("%calendar-monthNames")[i]+" </span>"+d+'<span class="wb-invisible">'+o+" "+k+((j)?pe.dic.get("%calendar-currentDay"):"")+"</span>")}else{if(pe.language==="fr"){c.append('<span class="wb-invisible">'+pe.dic.get("%calendar-weekDayNames")[m]+" </span>"+d+'<span class="wb-invisible"> '+pe.dic.get("%calendar-monthNames")[i].toLowerCase()+" "+k+((j)?pe.dic.get("%calendar-currentDay"):"")+"</span>")}}g.append(c);h=p}g.attr("id","cal-"+n+"-w"+b+"d"+(m+1)).addClass("cal-w"+b+"d"+(m+1)+" cal-index-"+d);if(m===0||m===6){g.addClass("cal-we")}if(j){g.addClass("cal-currentday")}h.append(g)}if(f){break}}return q},showGoToForm:function(a){$("#cal-"+a+"-monthnav").children(".cal-prevmonth, .cal-nextmonth").addClass("wb-invisible").children("a").attr("aria-hidden","true");var c=$("#cal-"+a+"-goto-link"),b=$("#cal-"+a+"-goto");c.stop().slideUp(0);b.stop().slideDown(0).queue(function(){pe.focus($(this).find(":input:eq(0)"))});c.children("a").attr("aria-hidden","true").attr("aria-expanded","true");$("#"+a).addClass("cal-container-extended")},hideGoToForm:function(a){var c=$("#cal-"+a+"-goto-link"),b=$("#cal-"+a+"-goto");b.stop().slideUp(0).queue(function(){$("#cal-"+a+"-monthnav").children(".cal-prevmonth, .cal-nextmonth").removeClass("wb-invisible").children("a").attr("aria-hidden","false");$("#"+a).removeClass("cal-container-extended")});c.stop().slideDown(0).children("a").attr("aria-hidden","false").attr("aria-expanded","false")},onGoTo:function(c,e,g){var b=$("#"+c),a=b.find("fieldset"),f=parseInt(a.find(".cal-goto-month select option:selected").attr("value"),10),d=parseInt(a.find(".cal-goto-year select").attr("value"),10);if(!(f<e.getMonth()&&d<=e.getFullYear())&&!(f>g.getMonth()&&d>=g.getFullYear())){calendar.create(c,d,f,true,calendar.getISOStringFromDate(e),calendar.getISOStringFromDate(g));calendar.hideGoToForm(c);pe.focus($("#cal-"+c+"-days").find("a:eq(0)"))}},getDateFromISOString:function(b){var a=null;if(b){if(b.match(/\d{4}-\d{2}-\d{2}/)){a=new Date();a.setFullYear(b.substr(0,4),b.substr(5,2)-1,b.substr(8,2)-1)}return a}return null},getISOStringFromDate:function(a){return a.getFullYear()+"-"+this.strPad(a.getMonth()+1,2,"0")+"-"+this.strPad(a.getDate()+1,2,"0")},strPad:function(b,a,c){var d=b.toString();if(!c){c="0"}while(d.length<a){d=c+d}return d}},dates={convert:function(a){return(a.constructor===Date?a:a.constructor===Array?new Date(a[0],a[1]-1,a[2]):a.constructor===Number?new Date(a):a.constructor===String?new Date(a):typeof a==="object"?new Date(a.year,a.month,a.date):NaN)},compare:function(d,c){return(isFinite(d=this.convert(d).valueOf())&&isFinite(c=this.convert(c).valueOf())?(d>c)-(d<c):NaN)},inRange:function(b,c,a){return(isFinite(b=this.convert(b).valueOf())&&isFinite(c=this.convert(c).valueOf())&&isFinite(a=this.convert(a).valueOf())?c<=b&&b<=a:NaN)},daysInMonth:function(a,b){return 32-new Date(a,b,32).getDate()},daysBetween:function(f,g){var e=this.convert(f),c=this.convert(g),a=0,h=1000*60,b=h*60*24,d;e.setHours(0);e.setMinutes(0);e.setSeconds(0);c.setHours(0);c.setMinutes(0);c.setSeconds(0);if(c>e){a=(c.getTimezoneOffset()-e.getTimezoneOffset())*h}else{a=(e.getTimezoneOffset()-c.getTimezoneOffset())*h}d=Math.abs(c.getTime()-e.getTime())-a;return Math.ceil(d/b)}};